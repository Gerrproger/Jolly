/*!
 * Jolly - modern responsive carousel with zooming
 * @version  v1.0.0
 * @author   Gerrproger
 * Website:  http://gerrproger.github.io/jolly
 * Repo:     http://github.com/gerrproger/jolly
 * Issues:   http://github.com/gerrproger/jolly/issues
 */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=t(e,document):"function"==typeof define&&define.amd?define(null,function(){t(e,document)}):e.jolly=t(e,document)}("undefined"!=typeof window?window:this,function(e,t){"use strict";function o(){var e=arguments;if(e.length){if(1==e.length)return e[0];for(var t=Array.prototype.shift.call(e),r=e.length,l=0;r>l;l++){var s=e[l];for(var n in s)s[n]&&s[n].constructor&&s[n].constructor===Object?(t[n]=t[n]||{},o(t[n],s[n])):t[n]=s[n]}return t}}function r(e,t,o){return e.replace(new RegExp(t.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1"),"g"),o)}function l(e,t,o){e.insertBefore(t,o)}function s(e,t){e.appendChild(t)}function n(e,t){for(var o in t)e.setAttribute(o,"boolean"==typeof t[o]&&t[o]?"":t[o])}function i(e,o,r){var l=t.createElement(e);return o&&n(l,o),r&&s(r,l),l}function c(e,t,o){if(e)if(e.classList)e.classList[o?"add":"remove"](t);else{var r=(" "+e.className+" ").replace(/\s+/g," ").replace(" "+t+" ","");e.className=r+(o?" "+t:"")}}function a(e,t,o,r){var l=t.split(" ");if(e instanceof NodeList)for(var s=0;s<e.length;s++)e[s]instanceof Node&&a(e[s],arguments[1],arguments[2]);else for(var n=0;n<l.length;n++)e[r?"addEventListener":"removeEventListener"](l[n],o,!1)}function f(){var e=i("p").style;return"transition"in e||"WebkitTransition"in e||"MozTransition"in e||"OTransition"in e}function m(e,t,o){function r(e){var t=null;e.target===k.scroller&&(c(k.scroller,d.selectors.scrollerTransition),"next"===b?(t=k.list[0],s(k.scroller,t.element),k.offset=k.offset+t.width,k.scroller.style[z]=k.offset+"px",k.active--,k.list.push(k.list.shift())):"prev"===b&&(t=k.list.slice(-1)[0],l(k.scroller,t.element,k.list[0].element),k.offset=k.offset-t.width,k.scroller.style[z]=k.offset+"px",k.active++,k.list.unshift(k.list.pop())),b=null)}function n(){b||(k.active--,k.offset=k.offset+k.list[k.active].width,p(k.list[k.active+1]),b="prev")}function f(){b||(k.offset=k.offset-k.list[k.active].width,k.active++,p(k.list[k.active-1]),b="next")}function m(e){var t=k.list[k.active];t.width+o.zoomDif>t.image.naturalWidth||(c(t.image,d.selectors.imageTransition,!0),t.element.style.width=t.width+"px",t.image.style.height=t.image.naturalHeight+"px",x={xRatio:(t.image.naturalWidth-t.width+120*o.zoomOffset)/t.width,yRatio:(t.image.naturalHeight-k.height+120*o.zoomOffset)/k.height,counter:o.zoomAnimDelay,image:t.image},v(e),a(k.controls.zoomer,"mousemove",v,!0))}function u(){function e(){c(t.image,d.selectors.imageTransition),a(t.image,"transitionend webkitTransitionEnd",v)}var t=k.list[k.active];c(t.image,d.selectors.imageTransition,!0),a(t.image,"transitionend webkitTransitionEnd",e,!0),t.image.style.height=null,t.image.style.left=null,t.image.style.top=null,x=null,a(k.controls.zoomer,"mousemove",v)}function v(e){var t=Date.now();if(x.counter&&t>A+x.counter*o.zoomAnimIncr||!x.counter){var r=k.list[k.active],l=e.offsetX*-x.xRatio+60*o.zoomOffset,s=e.offsetY*-x.yRatio+60*o.zoomOffset;l=Math.max(Math.min(l,0),-r.width*x.xRatio+120*o.zoomOffset),s=Math.max(Math.min(s,0),-k.height*x.yRatio+120*o.zoomOffset),r.image.style.left=l+"px",r.image.style.top=s+"px",x.counter&&(1===x.counter&&c(x.image,d.selectors.imageTransition),x.counter--)}A=t}function p(e){var t=k.list[k.active];c(k.scroller,d.selectors.scrollerTransition,!0),c(e.element,d.selectors.element+d.selectors.active),c(t.element,d.selectors.element+d.selectors.active,!0),k.scroller.style[z]=k.offset+"px",k.controls.block.style.width=t.width+"px"}function g(){y(),k.offset=-k.width+o.offset+(o.reversed?k.list[k.active].width:0),k.controls.block.style[z]=o.offset+"px",k.controls.block.style.width=k.list[k.active].width+"px",k.scroller.style[z]=k.offset+"px",c(k.list[k.active].element,d.selectors.element+d.selectors.active,!0),c(k.scroller,d.selectors.scroller+d.selectors.active,!0),c(k.controls.block,d.selectors.controls+d.selectors.active,!0),k.loaded=!0}function y(){for(var e=0;_>e;e++){var t=k.list[e].element.offsetWidth;k.list[e].width=k.list[e+_].width=k.list[e+2*_].width=t,k.width+=t}}function h(){j++,j===_&&g()}function w(){var e=k.wrap.parentNode;e.removeChild(k.wrap),delete e.jolly}var j=0,b=null,x=null,_=t.length,z=o.reflected?"right":"left",A=null,k={offset:100,height:0,width:0,loaded:!1,list:[],controls:{},active:o.reversed?_-1:_};k.wrap=i("div",{"class":d.selectors.wrapper},e),k.scroller=i("ul",{"class":d.selectors.scroller},k.wrap),k.height=k.scroller.offsetHeight,o.reflected&&c(k.wrap,d.selectors.wrapperReflected,!0),k.controls.block=i("div",{"class":d.selectors.controls},k.wrap),o.zooming&&c(k.controls.block,d.selectors.controlsZoom,!0),k.controls.prev=i("button",{"class":d.selectors.controlPrev},k.controls.block),k.controls.next=i("button",{"class":d.selectors.controlNext},k.controls.block),k.controls.zoomer=i("div",{"class":d.selectors.controlZoomer},k.controls.block),o.reversed&&t.reverse();for(var T=0;3>T;T++)for(var N in t){var O=t[N],R={width:0};R.element=i("li",{"class":d.selectors.element},k.scroller),R.image=i("img",{"class":d.selectors.image,src:O},R.element),0===T&&a(R.image,"load",h,!0),k.list.push(R)}return a(k.scroller,"transitionend webkitTransitionEnd",r,!0),a(k.controls.prev,"click",o.reversed?f:n,!0),a(k.controls.next,"click",o.reversed?n:f,!0),o.zooming&&(a(k.controls.zoomer,"mouseenter",m,!0),a(k.controls.zoomer,"mouseleave",u,!0)),{settings:o,tree:k,prev:o.reversed?f:n,next:o.reversed?n:f,destroy:w}}function u(e,l,s){var n=[],i=null,c=null,a=null;if(!1 in t||!f())return console.warn("jolly:","Not supported browser!"),!1;"object"==typeof s?a=s:"object"!=typeof l||Array.isArray(l)?"object"!=typeof e||Array.isArray(e)||(a=e):a=l,Array.isArray(l)?c=l:Array.isArray(e)&&(c=e),"string"==typeof e?i=t.querySelectorAll(e):e instanceof HTMLElement?i=[e]:e instanceof NodeList||(i=t.querySelectorAll(d.selectors.targets)),i instanceof NodeList&&(i=Array.prototype.slice.call(i));for(var u in i){var v=i[u];if(!("jolly"in v)){var p=v.getAttribute(d.selectors.targetsData),g=p?JSON.parse(r(p,"'",'"')):null;g=g?g:c;var y=v.getAttribute(d.selectors.targetsSettings),h=y?JSON.parse(r(y,"'",'"')):{};h=o({},d,a,h);var w=new m(v,g,h);v.jolly=Object.keys(w).length?w:!1}n.push(v)}return n}var d={offset:300,reflected:!1,reversed:!1,zooming:!0,zoomOffset:5,zoomDif:10,zoomAnimDelay:20,zoomAnimIncr:.3,selectors:{targets:"[data-jolly]",targetsData:"data-jolly",targetsSettings:"data-jolly-settings",wrapper:"jolly",wrapperReflected:"jolly__wrapper--reflected",active:"--active",scroller:"jolly__wrapper",scrollerTransition:"jolly__wrapper--transition",controls:"jolly__controls",controlsZoom:"jolly__controls--zoom",controlPrev:"jolly__control jolly__control--prev",controlNext:"jolly__control jolly__control--next",controlZoomer:"jolly__zoomer",element:"jolly__element",image:"jolly__img",imageTransition:"jolly__img--transition"}};return u});